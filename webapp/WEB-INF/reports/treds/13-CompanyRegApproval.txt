SELECT CompanyRegApproval.*
,TRIM(CLCITY) CITY
,TRIM(CLDISTRICT) DISTRICT
, TRIM(CLZIPCODE) ZIPCODE 
,TRIM(REFCODEVALUES.RCVDESC) STATE 
FROM 
(
SELECT CDID,CDCODE, CDCOMPANYNAME 
, (CASE WHEN CDSUPPLIERFLAG='Y' THEN 'Supplier' 
WHEN CDPURCHASERFLAG = 'Y' THEN 'Purchaser' 
WHEN CDFINANCIERFLAG = 'Y' THEN 'Financier' 
ELSE '' END) AS RegType
,CDRECORDCREATETIME ApprovedDateTime
,CWFRECORDCREATETIME SubmissionDateTime
,nvl(CDCREATORIDENTITY,'T') Creator
FROM COMPANYDETAILS 
LEFT OUTER JOIN 
(
SELECT MAX(CWFID) CWFID, CWFCDID, MAX(CWFRECORDCREATETIME) CWFRECORDCREATETIME
 FROM CompanyWorkFlow 
WHERE  CWFApprovalStatus IN ( 'S' , 'A' ) 
GROUP BY CWFCDID
) CompanyWorkFlow ON ( CDID = CWFCDID )
) CompanyRegApproval
LEFT OUTER JOIN COMPANYLOCATIONS ON (  CLCDID=CDID AND CLLOCATIONTYPE='R' )
LEFT OUTER JOIN REFCODEVALUES ON (RCVVALUE=CLSTATE AND RCVRECID=31)
ORDER BY 2