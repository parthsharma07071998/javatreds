SELECT 
FUID AS "Id"
, INID AS "Instrument Id"
, INPURCHASER AS "Buyer Code"
, CoPurc.CDCOMPANYNAME AS "Buyer Name"
, INSUPPLIER AS "Seller Code"
, CoSupp.CDCOMPANYNAME AS "Seller Name"
, ININSTNUMBER AS "Invoice Number"
, COSupp.CDMSMESTATUS AS "Sales Category"
, ININSTDATE AS "Invoice Date"
, INGOODSACCEPTDATE AS "Goods/Service Acceptance Date"
, ININSTDUEDATE AS "Invoice Due Date"
, ININSTDUEDATE AS "Maturity Date"
,INEXTENDEDDUEDATE AS "Extended Due Date"
, INAMOUNT AS "Invoice Amount"
, FUAMOUNT AS "Factoring Unit Cost"

, (CASE WHEN FUSTATUS ='LEG3' THEN 'Leg 3 Generated'
WHEN FUSTATUS ='FACT' THEN 'Factored'
WHEN FUSTATUS ='L1SET' THEN 'Leg 1 Settled'
WHEN FUSTATUS ='L1FAIL' THEN 'Leg 1 Failed'
WHEN FUSTATUS ='L2SET' THEN 'Leg 2 Settled'
WHEN FUSTATUS ='L2FAIL' THEN 'Leg 2 Failed'
ELSE '' END) AS "FU Status"


, FUACCEPTINGENTITY AS "Bid Accepting Entity Type"
, FUFACTOREDAMOUNT AS "Amount"

,(CASE WHEN INCHARGEBEARER ='P' THEN 'Purchaser' 
WHEN INCHARGEBEARER ='S' THEN 'Supplier'
ELSE '' END) AS "Charge Bearer"

, FUACCEPTEDRATE AS "Accepted Rate"
, FUACCEPTEDHAIRCUT AS "Accepted Haircut"
, FUACCEPTDATETIME AS "Accept Time"
, 0 AS "Tenor"
, FULIMITUTILIZED AS "Limit Utilized"
, NVL(FUPURSUPLIMITUTILIZED,'') AS "Buyer-Seller Limit Utilized"
, BDFINANCIERENTITY AS "Financier Code"
, CoFin.CDCOMPANYNAME AS "Financier"

, (TRIM(AUSALUTATION) || ' ' || TRIM(AUFIRSTNAME) || ' ' || TRIM(AUMIDDLENAME) || ' ' || TRIM(AULASTNAME)) AS "Financier Login"


, FUACCEPTEDRATE AS "Rate"
, FUACCEPTEDHAIRCUT AS "Retention Margin %"
, BDPROVVALIDTILL AS "Valid Till"

,(CASE WHEN BDSTATUS ='ACT' THEN 'Active'
WHEN BDSTATUS ='DEL' THEN 'Deleted'
WHEN BDSTATUS ='DLO' THEN 'Deleted By Owner'
WHEN BDSTATUS ='APT' THEN 'Accepted'
WHEN BDSTATUS ='REJ' THEN 'Auto Accept Failed'
WHEN BDSTATUS ='EXP' THEN 'EXPIRED'
WHEN BDSTATUS ='NAT' THEN 'Not Accepted'
ELSE '' END) AS "Status"


, BDID AS "Bid Id"
, BDTIMESTAMP AS "Timestamp"

,(CASE WHEN BDBIDTYPE ='RES' THEN 'Reserved' 
WHEN BDBIDTYPE ='OPN' THEN 'Open'
ELSE ' ' END) AS "Bid Type"

,(CASE WHEN BDCOSTLEG='L1' THEN 'Leg 1' 
WHEN BDCOSTLEG='L2' THEN 'Leg 2'
ELSE '' END) AS "Cost Leg"
FROM FACTORINGUNITS, BIDS,  APPUSERS, INSTRUMENTS , CompanyDetails CoPurc ,  CompanyDetails CoSupp , CompanyDetails CoFin 
WHERE FURECORDVERSION > 0
AND AURECORDVERSION > 0
AND INRECORDVERSION > 0
AND BDFUID = FUID
AND BDFINANCIERAUID = AUID
AND INFUID = FUID
AND FUFINANCIER != BDFINANCIERENTITY
AND FUSTATUS IN ( 'FACT', 'L1FAIL', 'L1SET', 'L2SET' )
AND BDRATE IS NULL
AND BDSTATUS IN ( 'EXP', 'DEL' )
AND CoPurc.CDCODE = INPurchaser
AND CoSupp.CDCODE = INSupplier
AND CoFin.CdCode = BDFINANCIERENTITY