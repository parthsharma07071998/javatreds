SELECT Rownum SrNo,CDCODE MemberCode, CDCOMPANYNAME COMPANYNAME 
, (CASE WHEN CDSUPPLIERFLAG='Y' THEN 'Supplier' 
WHEN CDPURCHASERFLAG = 'Y' THEN 'Purchaser'
ELSE '' END) AS RegistrationType,
(CASE WHEN CDCONSTITUTION='PROP' THEN 'Propritoryship' 
WHEN CDCONSTITUTION= 'PRIV' THEN 'Private'
WHEN CDCONSTITUTION= 'PUB' THEN 'Public'
WHEN CDCONSTITUTION= 'PART' THEN 'Partnership'
WHEN CDCONSTITUTION= 'TRST' THEN 'Trust'
WHEN CDCONSTITUTION= 'HUF' THEN 'HUF'
ELSE '' END)AS CONSTITUTION
, CDPAN Pan
, CDDATEOFINCORPORATION DateOfIncorporation
, NVL(CDMSMESTATUS,' ') MSMEStatus
-- , NVL(CDMSMEREGTYPE, ' ') MSMERegType
, (CASE WHEN CDMSMEREGTYPE = 'UAN' THEN CDMSMEREGNO ELSE ' ' END) AS UdyogAadharNo
, TO_CHAR(CDMSMEREGDATE, 'YYYY-MM-DD') As UdyogAadharDate
, NVL(CDCINNO,' ') CINNO
,Sector.RefDesc Sector
,Industry.RefDesc Industry
,SubSegment.RefDesc SubSegment
, State.RefDesc State
, CLSTATE StateCode
FROM COMPANYDETAILS 
LEFT OUTER JOIN 
(
SELECT RECCODE Code, RCVVALUE RefValue, RCVDESC RefDesc 
FROM REFCODEVALUES, REFCODES
WHERE RECRECORDVERSION > 0
AND RCVRECORDVERSION > 0
AND RCVRECID = RECID
AND RECCODE = 'SECTOR'
) Sector ON (Sector.RefValue = CDSECTOR)
LEFT OUTER JOIN 
(
SELECT RECCODE Code, RCVVALUE RefValue, RCVDESC RefDesc 
FROM REFCODEVALUES, REFCODES
WHERE RECRECORDVERSION > 0
AND RCVRECORDVERSION > 0
AND RCVRECID = RECID
AND RECCODE = 'INDUSTRY'
) Industry ON (Industry.RefValue = CDIndustry)
LEFT OUTER JOIN 
(
SELECT RECCODE Code, RCVVALUE RefValue, RCVDESC RefDesc 
FROM REFCODEVALUES, REFCODES
WHERE RECRECORDVERSION > 0
AND RCVRECORDVERSION > 0
AND RCVRECID = RECID
AND RECCODE = 'SUBSEGMENT'
) SubSegment ON (SubSegment.RefValue = (CDIndustry||'.'||CDSubSegment))
LEFT OUTER JOIN COMPANYLOCATIONS ON (CLCDID = CDID AND CLLOCATIONTYPE = 'R' AND CLRECORDVERSION > 0 )
LEFT OUTER JOIN 
(
SELECT RECCODE Code, RCVVALUE RefValue, RCVDESC RefDesc 
FROM REFCODEVALUES, REFCODES
WHERE RECRECORDVERSION > 0
AND RCVRECORDVERSION > 0
AND RCVRECID = RECID
AND RECCODE = 'GSTSTATE'
) State ON (State.RefValue = COMPANYLOCATIONS.CLSTATE)
WHERE CDSUPPLIERFLAG='Y' 
OR CDPURCHASERFLAG = 'Y'
